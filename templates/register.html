<!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/bootstrap1.min.css">
    <link rel="stylesheet" href="/static/css/bootstrap-admin1.min.css">
    <title>qloves--博客交流平台</title>
</head>
<body>

{#注册页面#}
<div class="min-vh-100 d-flex justify-content-center align-items-center py-3 bsa-bg-login2">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12  col-sm-7 col-xl-6 mx-auto p-2 bsa-bg-glass">
                <div class="row g-0">
                    <div class="col d-none d-lg-block">
                        <div class="card border-0 h-100 bg-secondary text-white bsa-opacity-80">
                            <div class="card-body">
                                <h5 class="card-title">qloves</h5>
                                <p class="card-text mt-3">
                                    QTribe博客交流平台
                                </p>
                                <p class="card-text mt-3">
                                    点击注册即代表同意QTribe的条件呦
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col">
                        <div class="card border-0 h-100">
                            <div class="card-body">
                                <form id="form" class="form">
                                    <div class="mb-3">
                                        <label for="username" class="form-label">账号</label>
                                        <input type="text" class="form-control" id="username" name="username"
                                               placeholder="用户名">
                                    </div>
                                    <div class="mb-3">
                                        <label for="username" class="form-label">电话号码</label>
                                        <input type="text" class="form-control" id="phone" name="phone"
                                               placeholder="电话号码">
                                    </div>
                                    <div class="mb-3">
                                        <label for="password" class="form-label">密码</label>
                                        <input type="password" class="form-control" id="password" name="password"
                                               placeholder="密码必须包含字母，数字且在8~16位之间">
                                    </div>
                                     <div class="mb-3">
                                        <label for="password" class="form-label">验证密码</label>
                                        <input type="password" class="form-control" id="password_again" name="password_again"
                                               placeholder="请再次输入密码">
                                    </div>
                                    <div class="mb-3">
                                        <label for="email" class="form-label">邮箱</label>
                                        <input type="text" class="form-control" id="email" name="email"
                                                placeholder="邮箱">
                                    </div>
                                    <div class="mb-3">
                                        <label for="captcha" class="form-label">验证码</label>
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="captcha" name="captcha"
                                                   placeholder="请输入验证码">
                                            <img src="/users/captcha/" alt="验证码" class="bsa-cursor-pointer"/>
                                        </div>
                                    </div>
                                    <div class="mb-3 d-grid gap-2">
                                        <button id="login-btn" type="submit" class="btn btn-secondary">注册用户</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="/static/js/bootstrap.bundle.min.js"></script>
<script src="/static/js/bootstrap-admin.min.js"></script>
<!--表单验证相关依赖-->
<script src="/static/lib/jquery/dist/jquery.min.js"></script>
<script src="/static/lib/formvalidation/js/formValidation.js"></script>
<script src="/static/lib/formvalidation/js/framework/bootstrap.js"></script>
<script src="/static/lib/formvalidation/js/language/zh_CN.js"></script>
<script>
    //前端表单验证
    $('#form').formValidation({
        fields: {
            username: {
                validators: {
                    notEmpty: true,
                    remote: {
                        type: 'post',
                        url: '/users/check_name/',
                        data: {
                            type: 'save',
                        },
                        //请求失败的消息
                        message: "该用户名已拥有，请重新输入",
                        delay: 1000
                    }
                }
            },
            password: {
            validators: {
                    notEmpty: true,
                    callback: {
                        callback: function (value, validator, $field) {
                            var mima =/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{8,16}$/
                            return mima.test(value)
                        },
                        message: '密码格式错误错误'
                    }
                },
            },
            password_again: {
                validators: {
                notEmpty:true,
                    identical: {
                        field: 'password',
                        message: '和密码不一致'
                    }
                }
            },
            sex: {
                validators: {
                    notEmpty: true,
                }
            },
            phone: {
                validators: {
                    notEmpty: true,
                    callback: {
                        callback: function (value, validator, $field) {
                            var reg1 = /^\+86-1[3-9]\d{9}$/;
                            var reg2 = /^1[3-9]\d{9}$/;
                            return reg1.test(value) || reg2.test(value);
                        },
                        message: '手机号错误'
                    }
                },
            },
             captcha: {
                validators: {
                    notEmpty: true,
                    remote: {
                        type: 'post',
                        url: '/users/check_captcha/',
                        data: {
                            type: 'save',
                        },
                        //请求失败的消息
                        message: "验证码错误，请重新输入",
                        delay: 1000
                    }
                }
            },
            email: {
                validators: {
                    notEmpty: true,
                    emailAddress: {
                        message: "email格式错误"
                    }

                }
            },
        }
    }).on('success.form.fv', function (e) {
        //阻止表单提交
        e.preventDefault();
        //得到表单对象
        var $form = $(e.target);
        let data = $form.serialize();

        //得到序列化数据
        $.ajax({
            url: "/users/create_user/",
            method: 'post',
            data: data,
        }).then(function (res) {
            if (res.code === 200) {
                //注册成功
                alert("注册成功")
                location.href='/users/login/'
            } else {
                //注册失败
                alert("注册失败")
                location.href='/users/register/'
            }
        });
    });


</script>

</body>
</html>
